name: CD.REACT

on:
  push:
    branches:
      - master
    paths:
      - "web/packages/react/**"

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Install common
        working-directory: ./web
        run: yarn install
      - name: Install
        working-directory: ./web/packages/react
        run: yarn install
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Install peers
        working-directory: ./web/packages/react
        run: yarn run install-peers
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Build
        working-directory: ./web/packages/react
        run: yarn run build
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Publish
        working-directory: ./web/packages/react
        run: yarn semantic-release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Install styleguidist
        working-directory: ./web/packages/react/doc
        run: yarn install
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Publish docs
        working-directory: ./web/packages/react/doc
        run: yarn deploy
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
